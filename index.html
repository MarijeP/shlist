<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Shopping List</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f9f7f4;
    --surface: #ffffff;
    --border: #e8e4de;
    --text: #1a1814;
    --muted: #9b9589;
    --accent: #2d6a4f;
    --accent-light: #e9f5ef;
    --checked-text: #b0aa9f;
    --danger: #c0392b;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  /* ‚îÄ‚îÄ LOGIN SCREEN ‚îÄ‚îÄ */
  #login-screen {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }

  .login-card {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 18px;
    padding: 48px 40px 40px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 4px 40px rgba(0,0,0,0.06);
  }

  .login-card h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 2rem;
    font-weight: 400;
    letter-spacing: -0.5px;
    margin-bottom: 4px;
  }

  .login-card h1 em {
    font-style: italic;
    color: var(--accent);
  }

  .login-subtitle {
    color: var(--muted);
    font-size: 0.85rem;
    font-weight: 300;
    margin-bottom: 32px;
  }

  .field { margin-bottom: 14px; }

  .field label {
    display: block;
    font-size: 0.78rem;
    font-weight: 500;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 6px;
  }

  .field input {
    width: 100%;
    padding: 12px 14px;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    background: var(--bg);
    color: var(--text);
    outline: none;
    transition: border-color 0.2s;
  }

  .field input:focus { border-color: var(--accent); background: white; }

  .btn-primary {
    width: 100%;
    padding: 13px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    margin-top: 8px;
    transition: opacity 0.2s, transform 0.1s;
  }

  .btn-primary:hover { opacity: 0.88; }
  .btn-primary:active { transform: scale(0.98); }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

  .login-error {
    background: #fdf0ee;
    border: 1.5px solid #f5c0b8;
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 0.85rem;
    color: var(--danger);
    margin-top: 14px;
    display: none;
  }

  /* ‚îÄ‚îÄ APP SCREEN ‚îÄ‚îÄ */
  #app-screen { display: none; padding: 40px 16px 80px; }

  .container { max-width: 560px; margin: 0 auto; }

  header { margin-bottom: 32px; }

  .header-top {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
  }

  h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 2.4rem;
    font-weight: 400;
    letter-spacing: -0.5px;
    line-height: 1.1;
  }

  .btn-signout {
    background: none;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    padding: 6px 12px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.78rem;
    color: var(--muted);
    cursor: pointer;
    white-space: nowrap;
    margin-top: 6px;
    transition: border-color 0.2s, color 0.2s;
    flex-shrink: 0;
  }

  .btn-signout:hover { border-color: var(--danger); color: var(--danger); }

  .subtitle { color: var(--muted); font-size: 0.85rem; font-weight: 300; margin-top: 4px; }

  .sync-status {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 0.78rem;
    color: var(--muted);
    margin-top: 8px;
  }

  .sync-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: #ccc;
    transition: background 0.3s;
  }

  .sync-dot.connected { background: var(--accent); }
  .sync-dot.connecting { background: #f0a500; animation: pulse 1s infinite; }
  .sync-dot.error { background: var(--danger); }

  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

  .add-form { display: flex; gap: 8px; margin-bottom: 28px; }

  .add-form input[type="text"] {
    flex: 1;
    padding: 12px 16px;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    background: var(--surface);
    outline: none;
    transition: border-color 0.2s;
    color: var(--text);
  }

  .add-form input[type="text"]:focus { border-color: var(--accent); }

  .add-form select {
    padding: 12px 12px;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    background: var(--surface);
    outline: none;
    color: var(--text);
    cursor: pointer;
  }

  .btn-add {
    padding: 12px 20px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
    white-space: nowrap;
  }

  .btn-add:hover { opacity: 0.88; }
  .btn-add:active { transform: scale(0.97); }

  .category-block { margin-bottom: 24px; animation: fadeIn 0.3s ease; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .category-label {
    font-size: 0.72rem;
    font-weight: 500;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 8px;
    padding-left: 4px;
  }

  .items-list {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    list-style: none;
  }

  .item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 13px 16px;
    border-bottom: 1px solid var(--border);
    transition: background 0.15s;
  }

  .item:last-child { border-bottom: none; }
  .item:hover { background: #fdfcfa; }
  .item.checked .item-name { color: var(--checked-text); text-decoration: line-through; }

  .item-check {
    appearance: none;
    width: 20px; height: 20px;
    border: 1.5px solid var(--border);
    border-radius: 6px;
    cursor: pointer;
    flex-shrink: 0;
    transition: all 0.15s;
    position: relative;
  }

  .item-check:checked { background: var(--accent); border-color: var(--accent); }

  .item-check:checked::after {
    content: '';
    position: absolute;
    left: 5px; top: 2px;
    width: 6px; height: 10px;
    border: 2px solid white;
    border-top: none; border-left: none;
    transform: rotate(45deg);
  }

  .item-name { flex: 1; font-size: 0.95rem; font-weight: 300; }

  .btn-delete {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--border);
    font-size: 1.1rem;
    line-height: 1;
    padding: 2px 4px;
    border-radius: 4px;
    transition: color 0.15s;
    flex-shrink: 0;
  }

  .btn-delete:hover { color: var(--danger); }

  .checked-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 28px;
    padding: 12px 16px;
    background: none;
    border: 1.5px dashed var(--border);
    border-radius: 10px;
    cursor: pointer;
    width: 100%;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    color: var(--muted);
    transition: border-color 0.2s, color 0.2s;
  }

  .checked-toggle:hover { border-color: var(--accent); color: var(--accent); }
  .checked-toggle .arrow { margin-left: auto; transition: transform 0.2s; font-size: 0.75rem; }
  .checked-toggle.open .arrow { transform: rotate(180deg); }

  .checked-section { margin-top: 12px; display: none; }
  .checked-section.visible { display: block; }
  .checked-section .item-name { color: var(--checked-text); text-decoration: line-through; }

  .empty { text-align: center; padding: 40px 20px; color: var(--muted); font-size: 0.9rem; font-weight: 300; }
  .empty span { display: block; font-size: 1.8rem; margin-bottom: 8px; }

  .config-banner {
    background: #fff8e6;
    border: 1.5px solid #f0d080;
    border-radius: 10px;
    padding: 14px 16px;
    margin-bottom: 24px;
    font-size: 0.88rem;
    line-height: 1.6;
    color: #7a5c00;
  }
  .config-banner strong { display: block; margin-bottom: 4px; }
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="login-screen">
  <div class="login-card">
    <h1>My <em>Shopping</em><br>List</h1>
    <p class="login-subtitle">Sign in to access your list</p>
    <div class="field">
      <label>Email</label>
      <input type="email" id="login-email" placeholder="you@example.com" autocomplete="email">
    </div>
    <div class="field">
      <label>Password</label>
      <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
    </div>
    <button class="btn-primary" id="login-btn" onclick="signIn()">Sign in</button>
    <div class="login-error" id="login-error"></div>
  </div>
</div>

<!-- APP SCREEN -->
<div id="app-screen">
  <div class="container">
    <header>
      <div class="header-top">
        <h1>Shopping List</h1>
        <button class="btn-signout" onclick="signOut()">Sign out</button>
      </div>
      <p class="subtitle" id="stats-text">Loading‚Ä¶</p>
      <div class="sync-status">
        <div class="sync-dot connecting" id="sync-dot"></div>
        <span id="sync-label">Connecting‚Ä¶</span>
      </div>
    </header>

    <div class="config-banner" id="config-banner" style="display:none">
      <strong>‚ö†Ô∏è Firebase not configured yet</strong>
      Open this file in a text editor and replace the placeholder values in the firebaseConfig block with your real Firebase config.
    </div>

    <div class="add-form">
      <input type="text" id="item-input" placeholder="Add an item‚Ä¶" autocomplete="off">
      <select id="category-select">
        <option value="General">General</option>
        <option value="Produce">Produce</option>
        <option value="Dairy">Dairy</option>
        <option value="Meat">Meat</option>
        <option value="Bakery">Bakery</option>
        <option value="Pantry">Pantry</option>
        <option value="Frozen">Frozen</option>
        <option value="Drinks">Drinks</option>
        <option value="Household">Household</option>
        <option value="Other">Other</option>
      </select>
      <button class="btn-add" onclick="addItem()">Add</button>
    </div>

    <div id="active-list"></div>

    <button class="checked-toggle" id="checked-toggle" onclick="toggleChecked()" style="display:none">
      <span id="checked-label">üóÇ Checked off items</span>
      <span class="arrow">‚ñº</span>
    </button>
    <div class="checked-section" id="checked-section"></div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut as fbSignOut, onAuthStateChanged }
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getDatabase, ref, push, update, remove, onValue, off }
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // ================================================================
  // PASTE YOUR FIREBASE CONFIG HERE ‚Äî replace every value below
  // ================================================================
  const firebaseConfig = {
    apiKey:            "PASTE_YOUR_apiKey_HERE",
    authDomain:        "PASTE_YOUR_authDomain_HERE",
    databaseURL:       "PASTE_YOUR_databaseURL_HERE",
    projectId:         "PASTE_YOUR_projectId_HERE",
    storageBucket:     "PASTE_YOUR_storageBucket_HERE",
    messagingSenderId: "PASTE_YOUR_messagingSenderId_HERE",
    appId:             "PASTE_YOUR_appId_HERE"
  };
  // ================================================================

  const isConfigured = !Object.values(firebaseConfig).some(v => String(v).startsWith('PASTE_'));

  if (!isConfigured) {
    document.getElementById('config-banner').style.display = 'block';
    showApp();
  }

  const app = isConfigured ? initializeApp(firebaseConfig) : null;
  const auth = isConfigured ? getAuth(app) : null;
  const db = isConfigured ? getDatabase(app) : null;

  let items = [];
  let currentListRef = null;

  if (auth) {
    onAuthStateChanged(auth, (user) => {
      if (user) {
        showApp();
        connectList(user.uid);
      } else {
        showLogin();
        disconnectList();
      }
    });
  }

  function showLogin() {
    document.getElementById('login-screen').style.display = 'flex';
    document.getElementById('app-screen').style.display = 'none';
  }

  function showApp() {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('app-screen').style.display = 'block';
  }

  function connectList(uid) {
    disconnectList();
    currentListRef = ref(db, `users/${uid}/shoppingList`);
    setSyncStatus('connecting', 'Connecting‚Ä¶');
    onValue(currentListRef, (snapshot) => {
      const data = snapshot.val();
      items = data ? Object.entries(data).map(([id, val]) => ({ id, ...val })) : [];
      setSyncStatus('connected', 'Synced');
      render();
    }, () => setSyncStatus('error', 'Connection error'));
  }

  function disconnectList() {
    if (currentListRef) { off(currentListRef); currentListRef = null; }
    items = [];
  }

  window.signIn = async function() {
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;
    const btn = document.getElementById('login-btn');
    const errEl = document.getElementById('login-error');

    errEl.style.display = 'none';
    btn.disabled = true;
    btn.textContent = 'Signing in‚Ä¶';

    try {
      await signInWithEmailAndPassword(auth, email, password);
    } catch (e) {
      errEl.textContent = friendlyAuthError(e.code);
      errEl.style.display = 'block';
      btn.disabled = false;
      btn.textContent = 'Sign in';
    }
  };

  window.signOut = async function() {
    await fbSignOut(auth);
  };

  function friendlyAuthError(code) {
    if (['auth/invalid-credential','auth/wrong-password','auth/user-not-found'].includes(code))
      return 'Incorrect email or password. Please try again.';
    if (code === 'auth/invalid-email') return 'Please enter a valid email address.';
    if (code === 'auth/too-many-requests') return 'Too many attempts. Please try again later.';
    return 'Something went wrong. Please try again.';
  }

  window.addItem = function() {
    if (!currentListRef) return;
    const input = document.getElementById('item-input');
    const cat = document.getElementById('category-select').value;
    const name = input.value.trim();
    if (!name) return;
    push(currentListRef, { name, category: cat, checked: false });
    input.value = '';
    input.focus();
  };

  window.toggleCheck = function(id) {
    const item = items.find(i => i.id === id);
    if (item && db && auth.currentUser)
      update(ref(db, `users/${auth.currentUser.uid}/shoppingList/${id}`), { checked: !item.checked });
  };

  window.deleteItem = function(id) {
    if (db && auth.currentUser)
      remove(ref(db, `users/${auth.currentUser.uid}/shoppingList/${id}`));
  };

  window.toggleChecked = function() {
    document.getElementById('checked-section').classList.toggle('visible');
    document.getElementById('checked-toggle').classList.toggle('open');
  };

  function setSyncStatus(state, label) {
    const dot = document.getElementById('sync-dot');
    const lbl = document.getElementById('sync-label');
    if (dot) dot.className = 'sync-dot ' + state;
    if (lbl) lbl.textContent = label;
  }

  function escHtml(str) {
    return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  function render() {
    const active = items.filter(i => !i.checked);
    const checked = items.filter(i => i.checked);

    const statsEl = document.getElementById('stats-text');
    if (statsEl) {
      statsEl.textContent = items.length === 0
        ? 'Nothing here yet ‚Äî add your first item'
        : `${active.length} item${active.length !== 1 ? 's' : ''} remaining${checked.length ? ` ¬∑ ${checked.length} checked off` : ''}`;
    }

    const activeEl = document.getElementById('active-list');
    if (!activeEl) return;

    if (active.length === 0) {
      activeEl.innerHTML = checked.length === 0
        ? `<div class="empty"><span>üõí</span>Your list is empty</div>`
        : `<div class="empty"><span>‚úÖ</span>All done!</div>`;
    } else {
      const cats = [...new Set(active.map(i => i.category))];
      activeEl.innerHTML = cats.map(cat => {
        const catItems = active.filter(i => i.category === cat);
        return `
          <div class="category-block">
            ${cats.length > 1 || cat !== 'General' ? `<div class="category-label">${cat}</div>` : ''}
            <ul class="items-list">
              ${catItems.map(item => `
                <li class="item">
                  <input type="checkbox" class="item-check" onchange="toggleCheck('${item.id}')">
                  <span class="item-name">${escHtml(item.name)}</span>
                  <button class="btn-delete" onclick="deleteItem('${item.id}')" title="Remove">‚úï</button>
                </li>`).join('')}
            </ul>
          </div>`;
      }).join('');
    }

    const toggleBtn = document.getElementById('checked-toggle');
    const checkedEl = document.getElementById('checked-section');

    if (checked.length === 0) {
      toggleBtn.style.display = 'none';
      checkedEl.innerHTML = '';
    } else {
      toggleBtn.style.display = 'flex';
      document.getElementById('checked-label').textContent = `üóÇ Checked off items (${checked.length})`;
      const checkedCats = [...new Set(checked.map(i => i.category))];
      checkedEl.innerHTML = checkedCats.map(cat => {
        const catItems = checked.filter(i => i.category === cat);
        return `
          <div class="category-block">
            ${checkedCats.length > 1 || cat !== 'General' ? `<div class="category-label">${cat}</div>` : ''}
            <ul class="items-list">
              ${catItems.map(item => `
                <li class="item checked">
                  <input type="checkbox" class="item-check" checked onchange="toggleCheck('${item.id}')">
                  <span class="item-name">${escHtml(item.name)}</span>
                  <button class="btn-delete" onclick="deleteItem('${item.id}')" title="Remove">‚úï</button>
                </li>`).join('')}
            </ul>
          </div>`;
      }).join('');
    }
  }

  document.getElementById('item-input')?.addEventListener('keydown', e => {
    if (e.key === 'Enter') window.addItem();
  });

  document.getElementById('login-password')?.addEventListener('keydown', e => {
    if (e.key === 'Enter') window.signIn();
  });
</script>
</body>
</html>
